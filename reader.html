<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø´ÙŠÙ† PRO - Ø­Ù„Ù… Ø·Ù†Ø¬Ø§Ø±</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@600&family=Lateef&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #f4f1ea; --text: #2c3e50; --size: 1.35rem; --h-color: #ffeb3b88; --font-fam: 'Amiri', serif; }
        body.dark { --bg: #1a1a1b; --text: #d5d5d5; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: var(--font-fam); overflow: hidden; transition: 0.3s; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø·ÙˆØ± */
        .header { height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; background: rgba(0,0,0,0.05); backdrop-filter: blur(10px); position: fixed; top: 0; width: 100%; z-index: 1000; }
        .nav-right { display: flex; gap: 15px; align-items: center; }
        .icon-btn { cursor: pointer; font-size: 1.2rem; background: none; border: none; color: var(--text); padding: 5px; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ø§Ù„ÙÙ‡Ø±Ø³) */
        .sidebar { position: fixed; top: 0; right: -280px; width: 280px; height: 100%; background: var(--bg); border-left: 1px solid #ccc; z-index: 2000; transition: 0.4s; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .sidebar.open { right: 0; box-shadow: -5px 0 15px rgba(0,0,0,0.1); }
        .sidebar h3 { font-family: 'Cairo'; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
        .chapter-link { display: block; padding: 10px; border-bottom: 1px dashed #ddd; cursor: pointer; font-size: 1rem; }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† */
        .settings-panel { display: none; position: fixed; top: 65px; left: 15px; background: white; padding: 15px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); z-index: 1500; width: 200px; }
        .font-opt { display: block; margin: 10px 0; cursor: pointer; font-family: 'Cairo'; font-size: 14px; text-align: center; border: 1px solid #eee; padding: 5px; border-radius: 5px; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© */
        #viewport { margin-top: 60px; height: calc(100vh - 100px); width: 100vw; display: flex; transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1); }
        .page-box { min-width: 100vw; box-sizing: border-box; padding: 25px 10%; text-align: justify; font-size: var(--size); line-height: 2.2; position: relative; }
        
        /* ØªØ£Ø«ÙŠØ± Ø«Ù†ÙŠØ© Ø§Ù„ÙˆØ±Ù‚Ø© */
        .page-box::after { content: ''; position: absolute; bottom: 0; left: 0; width: 20px; height: 20px; background: linear-gradient(135deg, transparent 50%, rgba(0,0,0,0.05) 50%); }

        /* Ø§Ù„ÙÙˆØªØ± Ø§Ù„Ø°ÙƒÙŠ */
        .footer { position: fixed; bottom: 0; width: 100%; height: 40px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; background: rgba(0,0,0,0.02); font-family: 'Cairo'; font-size: 11px; box-sizing: border-box; }
        
        /* Ø§Ù„Ù…Ø§Ø±ÙƒØ± ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ© */
        ::selection { background: var(--h-color); }
        .share-btn { position: fixed; display: none; background: #e67e22; color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; cursor: pointer; z-index: 3000; font-family: 'Cairo'; }

        .side-nav { position: fixed; top: 60px; height: calc(100vh - 100px); width: 10%; cursor: pointer; z-index: 100; }
    </style>
</head>
<body class="sepia-mode">

    <div class="header">
        <button class="icon-btn" onclick="toggleSidebar()">â˜°</button>
        <div class="nav-right">
            <button class="icon-btn" onclick="toggleSettings()">âš™ï¸</button>
            <button class="icon-btn" onclick="showSearch()">ğŸ”</button>
            <button class="icon-btn" onclick="document.body.classList.toggle('dark')">ğŸŒ™</button>
            <button class="icon-btn" onclick="location.href='index.html'">âœ•</button>
        </div>
    </div>

    <div id="sidebar" class="sidebar">
        <h3>ÙØµÙˆÙ„ Ø§Ù„Ø±ÙˆØ§ÙŠØ©</h3>
        <div id="chapter-list"></div>
    </div>

    <div id="settings" class="settings-panel">
        <span class="font-opt" onclick="setF('Amiri')">Ø®Ø· Ø£Ù…ÙŠØ±ÙŠ (ÙƒÙ„Ø§Ø³ÙŠÙƒ)</span>
        <span class="font-opt" onclick="setF('Cairo')">Ø®Ø· ÙƒØ§ÙŠØ±Ùˆ (Ù…ÙˆØ¯Ø±Ù†)</span>
        <span class="font-opt" onclick="setF('Lateef')">Ø®Ø· Ù„Ø·ÙŠÙ (Ù†Ø§Ø¹Ù…)</span>
        <hr>
        <div style="display:flex; justify-content: space-around;">
            <div onclick="setH('#ffeb3b88')" style="width:20px;height:20px;background:#ffeb3b;border-radius:50%"></div>
            <div onclick="setH('#ff525288')" style="width:20px;height:20px;background:#ff5252;border-radius:50%"></div>
            <div onclick="setH('#448aff88')" style="width:20px;height:20px;background:#448aff;border-radius:50%"></div>
        </div>
    </div>

    <div id="shareBtn" class="share-btn" onclick="shareQuote()">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³</div>

    <div id="viewport"> <div class="page-box">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div> </div>

    <div class="footer">
        <span id="reading-time">Ù…ØªØ¨Ù‚ÙŠ: -- Ø¯Ù‚ÙŠÙ‚Ø©</span>
        <span id="pg">1 / ...</span>
    </div>

    <div class="side-nav" style="left:0" onclick="move(1)"></div>
    <div class="side-nav" style="right:0" onclick="move(-1)"></div>

    <script>
        let cur = 0, total = 0, bID = "tangar";

        async function load() {
            try {
                const res = await fetch('tangar.txt');
                const text = await res.text();
                build(text);
                genChapters(text);
            } catch(e) { console.error("Load failed"); }
        }

        function build(txt) {
            const v = document.getElementById('viewport'); v.innerHTML = "";
            const words = txt.split(/\s+/);
            const wpp = 200; // ÙƒÙ„Ù…Ø§Øª ÙÙŠ ÙƒÙ„ ØµÙØ­Ø©
            for(let i=0; i<words.length; i+=wpp) {
                const div = document.createElement('div');
                div.className = 'page-box';
                div.innerHTML = `<p>${words.slice(i, i+wpp).join(' ')}</p>`;
                v.appendChild(div);
            }
            total = document.querySelectorAll('.page-box').length;
            const s = localStorage.getItem('last_'+bID);
            if(s) cur = parseInt(s);
            update();
        }

        function update() {
            document.getElementById('viewport').style.transform = `translateX(${cur * 100}vw)`;
            document.getElementById('pg').innerText = `${cur + 1} / ${total}`;
            // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (Ù…ØªÙˆØ³Ø· 200 ÙƒÙ„Ù…Ø© ÙÙŠ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©)
            let rem = Math.ceil((total - cur) * 1); 
            document.getElementById('reading-time').innerText = `Ù…ØªØ¨Ù‚ÙŠ: ${rem} Ø¯Ù‚ÙŠÙ‚Ø©`;
            localStorage.setItem('last_'+bID, cur);
        }

        function move(d) { if(d===1 && cur < total-1) cur++; else if(d===-1 && cur > 0) cur--; update(); }

        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙÙŠØ©
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        function toggleSettings() { 
            const s = document.getElementById('settings');
            s.style.display = (s.style.display==='block')?'none':'block'; 
        }
        function setF(f) { document.documentElement.style.setProperty('--font-fam', f); toggleSettings(); }
        function setH(c) { document.documentElement.style.setProperty('--h-color', c); toggleSettings(); }

        function genChapters(txt) {
            const list = document.getElementById('chapter-list');
            // Ø¨Ø­Ø« Ø¨Ø³ÙŠØ· Ø¹Ù† ÙƒÙ„Ù…Ø© "ÙØµÙ„" Ø£Ùˆ ØªÙ‚Ø³ÙŠÙ… Ø¢Ù„ÙŠ
            for(let i=1; i<=10; i++) { // Ù…Ø«Ø§Ù„ Ù„Ù€ 10 ÙØµÙˆÙ„
                const item = document.createElement('div');
                item.className = 'chapter-link';
                item.innerText = `Ø§Ù„ÙØµÙ„ ${i}`;
                item.onclick = () => { cur = Math.floor(total/10 * (i-1)); update(); toggleSidebar(); };
                list.appendChild(item);
            }
        }

        // Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³
        document.onmouseup = function(e) {
            let s = window.getSelection().toString();
            let btn = document.getElementById('shareBtn');
            if(s && s.length > 5) {
                btn.style.display = 'block';
                btn.style.top = (e.pageY - 40) + 'px';
                btn.style.left = e.pageX + 'px';
            } else { btn.style.display = 'none'; }
        };

        function shareQuote() {
            let s = window.getSelection().toString();
            let url = `https://twitter.com/intent/tweet?text=Ø§Ù‚ØªØ¨Ø§Ø³ Ù…Ù† Ø±ÙˆØ§ÙŠØ© Ø­Ù„Ù… Ø·Ù†Ø¬Ø§Ø±: "${s}"`;
            window.open(url, '_blank');
        }

        function showSearch() {
            let word = prompt("Ø¹Ù† Ù…Ø§Ø°Ø§ ØªØ¨Ø­Ø« ÙÙŠ Ø­Ù„Ù… Ø·Ù†Ø¬Ø§Ø±ØŸ");
            if(word) alert("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«... Ù…ÙŠØ²Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø³ØªØ¹Ù…Ù„ Ø¨Ù…Ø¬Ø±Ø¯ Ø±Ø¨Ø· Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©.");
        }

        // Ø¯Ø¹Ù… Ø§Ù„Ù„Ù…Ø³
        let sX = 0;
        document.addEventListener('touchstart', e => sX = e.touches[0].clientX);
        document.addEventListener('touchend', e => {
            let dX = sX - e.changedTouches[0].clientX;
            if(Math.abs(dX) > 60) move(dX > 0 ? 1 : -1);
        });

        window.onload = load;
    </script>
</body>
</html>
