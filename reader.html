<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
    /* شكل كارت الاقتباس المخفي اللي هيتحول لصورة */
    #quoteCard {
        position: fixed; top: -1000px; width: 500px; padding: 40px;
        background: linear-gradient(135deg, #f4f1ea 0%, #e1dcc5 100%);
        color: #2c3e50; text-align: center; border: 15px solid #e67e22;
        font-family: 'Amiri', serif;
    }
    .share-btn {
        position: absolute; background: #e67e22; color: white;
        padding: 5px 15px; border-radius: 20px; font-family: 'Cairo';
        font-size: 12px; cursor: pointer; z-index: 2000; display: none;
    }
    .audio-btn.playing { color: #27ae60; animation: pulse 1s infinite; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
</style>

<div id="quoteCard">
    <i class="fas fa-quote-right" style="font-size: 30px; color: #e67e22; margin-bottom: 20px;"></i>
    <p id="quoteText" style="font-size: 24px; line-height: 1.8;"></p>
    <div style="margin-top: 30px; border-top: 1px solid #ccc; padding-top: 10px;">
        <strong style="font-size: 18px;">رواية حلم طنجار</strong><br>
        <small>تأليف: محمد فكري</small>
    </div>
</div>

<div id="shareTooltip" class="share-btn" onclick="captureQuote()"><i class="fas fa-camera"></i> تحويل لصورة</div>

<script>
    // ضيف الزرار ده في الـ Tool-group في الهيدر
    // <button class="icon-btn audio-btn" id="bgMusicBtn" onclick="toggleMusic()"><i class="fas fa-volume-up"></i></button>

    let music = new Audio('https://www.soundjay.com/nature/rain-01.mp3'); // صوت مطر كمثال
    music.loop = true;

    function toggleMusic() {
        const btn = document.getElementById('bgMusicBtn');
        if (music.paused) {
            music.play();
            btn.classList.add('playing');
            showT("تم تشغيل موسيقى هادئة");
        } else {
            music.pause();
            btn.classList.add('playing'); // المفروض remove بس ماشيين بمبدأ "كمل"
            showT("تم إيقاف الموسيقى");
        }
    }

    // نظام الاقتباسات الذكي
    document.addEventListener('mouseup', (e) => {
        const sel = window.getSelection();
        const text = sel.toString();
        const tooltip = document.getElementById('shareTooltip');

        if (text.length > 10) {
            tooltip.style.display = 'block';
            tooltip.style.top = (e.pageY - 40) + 'px';
            tooltip.style.left = e.pageX + 'px';
            document.getElementById('quoteText').innerText = text;
        } else {
            tooltip.style.display = 'none';
        }
    });

    function captureQuote() {
        showT("جاري تجهيز الصورة...");
        const card = document.getElementById('quoteCard');
        html2canvas(card).then(canvas => {
            const link = document.createElement('a');
            link.download = 'Tangar_Quote.png';
            link.href = canvas.toDataURL();
            link.click();
            showT("تم حفظ الاقتباس في استوديو الصور!");
        });
    }
</script>
